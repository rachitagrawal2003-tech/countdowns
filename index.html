<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Countdowns + Gallery ‚è≥üì∏</title>
  <style>
    /* ---------- existing styles (kept + slightly extended) ---------- */
    .header-image img {
      width: 100%;
      max-height: 250px;
      object-fit: cover;
      border-radius: 15px;
      margin-top: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: fadeIn 1.4s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: scale(1.02); } to { opacity: 1; transform: scale(1); } }
    body {
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: #fffafc;
      color: #3b3b3b;
      margin: 0;
      text-align: center;
    }
    h1 { font-size: 2rem; color: #e08eb4; margin: 28px 0 6px; }
    .countdowns { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 20px; }
    .card {
      background: #ffeef4;
      border-radius: 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
      width: 250px;
      padding: 20px;
      position: relative;
      transition: transform .25s ease;
      cursor: pointer;
    }
    .card:hover { transform: translateY(-4px); }
    .emoji { font-size: 2rem; }
    .event { font-size: 1.2rem; color: #ff7da5; font-weight: 600; margin-top: 8px; }
    .days { font-size: 2.2rem; color: #5a4f4f; font-weight: 800; margin: 6px 0; }
    .note { font-size: .92rem; color: #6d6262; margin-top: 4px; }
    img.card-img {
      width: 80%;
      border-radius: 12px;
      margin-top: 10px;
    }
    footer { margin: 26px 0 36px; font-size: .82rem; color: #9b8b8b; }

    /* Modal */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,.38); display: none; align-items: center; justify-content: center; padding: 20px; z-index: 999; }
    .modal.open { display: flex; }
    .modal-card { background: #fff; max-width: 520px; width: 100%; border-radius: 20px; box-shadow: 0 12px 28px rgba(0,0,0,.18); padding: 26px 22px; }
    .modal-title { font-size: 1.2rem; color: #ff74a1; margin: 0 0 6px; }
    .modal-sub { font-size: .95rem; color: #6d6262; margin: 0 0 16px; }
    .bigtime { font-variant-numeric: tabular-nums; letter-spacing: .5px; font-size: 2.4rem; font-weight: 800; color: #3f3a3a; margin: 10px 0 6px; }
    .units { font-size: .8rem; color: #8a7f7f; margin-bottom: 14px; }
    .modal-close { margin-top: 10px; background: #ffe0eb; border: none; color: #7a5b66; padding: 10px 16px; border-radius: 10px; font-weight: 600; cursor: pointer; }
    .modal-close:hover { background: #ffd3e3; }
    #first-talk p, #first-date p, #first-iloveyou p { font-size: 1.1rem; font-weight: 500; color: #d47fa6; }

    /* ---------- gallery styles ---------- */
    .gallery-controls {
      max-width: 980px;
      margin: 18px auto 6px;
      padding: 10px 18px;
      text-align: left;
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }
    .file-input-label {
      background: #ffdfe9;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      color: #6b3b4a;
      font-weight: 600;
    }
    .url-input {
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #e6c7d4;
      width: 260px;
      outline: none;
    }
    .add-url-btn {
      padding: 8px 12px;
      border-radius: 10px;
      background: #ffe0eb;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

.gallery {
  max-width: 720px;
  margin: 24px auto 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 14px;
  padding: 0 14px;
}

.gallery-card {
  background: #fff1f7;
  border-radius: 12px;
  padding: 8px;
  box-shadow: 0 8px 28px rgba(0,0,0,0.08);
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  max-width: 640px;
}

.gallery-card img {
  width: 100%;
  height: auto;
  max-height: 600px;
  border-radius: 8px;
  object-fit: cover;
}
    .gallery-note {
      font-size: 0.9rem;
      color: #7a525f;
      margin-top: 8px;
      font-weight: 600;
    }

    .small-muted {
      font-size: 12px;
      color: #9b8b8b;
      margin-left: 6px;
    }

    /* responsive */
    @media (max-width: 480px) {
      .card { width: calc(50% - 30px); }
    }
  </style>
</head>
<body>
  <div class="header-image">
    <img src="i-love-you.jpg" alt="I Love You" />
  </div>
  <h1>Countdowns ‚è≥ + Gallery üì∏</h1>

  <!-- ---------- countdowns (same as before) ---------- -->
  <div class="countdowns">
    <!-- (kept your same countdown card markup) -->
    <div class="card"
      data-title="Our Anniversary üíû"
      data-date="09-06"
      data-note="Celebrating us, every 6th September üíå"
      data-img="your-anniversary-image.jpg">
      <div class="emoji">üíû</div>
      <div class="event">Our Anniversary</div>
      <div class="days"></div>
      <div class="note">Celebrating us, every 6th September üíå</div>
      <img class="card-img" src="your-anniversary-image.jpg" alt="Our Anniversary"/>
    </div>

    <div class="card"
      data-title="Kitten‚Äôs Birthday üéÇ"
      data-date="01-02"
      data-note="tehe"
      data-img="kitten-birthday.jpg">
      <div class="emoji">üéÇ</div>
      <div class="event">Kitten‚Äôs Birthday</div>
      <div class="days"></div>
      <div class="note">tehe</div>
      <img class="card-img" src="kitten-birthday.jpg" alt="Kitten Birthday"/>
    </div>

    <div class="card"
      data-title="Daddy‚Äôs Birthday üéâ"
      data-date="04-14"
      data-note="your special day, muah!"
      data-img="daddy-birthday.jpg">
      <div class="emoji">üéâ</div>
      <div class="event">Daddy‚Äôs Birthday</div>
      <div class="days"></div>
      <div class="note">your special day, muah!</div>
      <img class="card-img" src="daddy-birthday.jpg" alt="Daddy Birthday"/>
    </div>

    <div class="card"
      data-title="End of Exams üìö"
      data-absolute="2025-12-30T23:59:59"
      data-note="The end of stressüå∑"
      data-img="exam-end.jpg">
      <div class="emoji">üìö</div>
      <div class="event">End of Exams</div>
      <div class="days"></div>
      <div class="note">The end of stressüå∑</div>
      <img class="card-img" src="exam-end.jpg" alt="End of Exams"/>
    </div>

    <div class="card"
      data-title="We meet!! üíû"
      data-absolute="2025-11-27T00:00:00"
      data-note="Finally together again üíñ"
      data-img="meeting.jpg">
      <div class="emoji">üíû</div>
      <div class="event">We meet!!</div>
      <div class="days"></div>
      <div class="note">Finally together again üíñ</div>
      <img class="card-img" src="meeting.jpg" alt="Our Meeting"/>
    </div>

    <h2 style="margin-top: 40px; width: 100%;">‚ú® Our Journey So Far ‚ú®</h2>

    <div class="card" id="first-talk" onclick="toggleDetail('talk', '2025-04-22')">
      <h2>üí¨ Days Since We First Talked</h2>
      <p id="talk-days">Loading...</p>
    </div>

    <div class="card" id="first-date" onclick="toggleDetail('date', '2025-08-03')">
      <h2>üç∞ Days Since Our First Date</h2>
      <p id="date-days">Loading...</p>
    </div>

    <div class="card" id="first-iloveyou" onclick="toggleDetail('love', '2025-08-28')">
      <h2>‚ù§Ô∏è Days Since We Said "I Love You"</h2>
      <p id="love-days">Loading...</p>
    </div>
  </div>

  <!-- ---------- Gallery controls ---------- -->
  <div class="gallery-controls">
    <label class="file-input-label">
      üì§ Upload images
      <input id="fileInput" type="file" multiple accept="image/*" style="display:none">
    </label>

    <input id="urlInput" class="url-input" type="url" placeholder="Paste image URL and press Add" />
    <button id="addUrlBtn" class="add-url-btn">Add URL</button>

    <div class="small-muted">Tip: click any gallery card to swap to a random image</div>
  </div>

  <!-- ---------- Gallery grid ---------- -->
  <div id="gallery" class="gallery" aria-live="polite">
    <!-- Gallery cards will be appended here -->
  </div>

  <footer>Made with üíñ by Kitten</footer>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-card">
      <h3 class="modal-title" id="modalTitle"></h3>
      <p class="modal-sub" id="modalNote"></p>
      <div class="bigtime" id="liveTime"></div>
      <div class="units">Days : Hours : Minutes : Seconds</div>
      <button class="modal-close" id="closeBtn">Close</button>
    </div>
  </div>

  <script>
  /* ========== Existing countdown modal & days logic ========== */
  const modal = document.getElementById("modal");
  const modalTitle = document.getElementById("modalTitle");
  const modalNote = document.getElementById("modalNote");
  const liveTime = document.getElementById("liveTime");
  const closeBtn = document.getElementById("closeBtn");
  let timer = null;

  const intervals = {};
  function updateDetailedTime(startDate, elementId, mode = "days") {
    const start = new Date(startDate);
    const now = new Date();
    const diff = now - start;
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const minutes = Math.floor((diff / (1000 * 60)) % 60);
    const seconds = Math.floor((diff / 1000) % 60);
    const element = document.getElementById(elementId);
    if (!element) return;
    if (mode === "days") {
      element.textContent = `${days} days üí´`;
    } else {
      element.textContent = `${days} days, ${hours} hrs, ${minutes} mins, ${seconds} secs ‚ú®`;
    }
  }
  function toggleDetail(type, startDate) {
    const elementId = `${type}-days`;
    if (intervals[type]) {
      clearInterval(intervals[type]);
      intervals[type] = null;
      updateDetailedTime(startDate, elementId, "days");
    } else {
      updateDetailedTime(startDate, elementId, "full");
      intervals[type] = setInterval(() => updateDetailedTime(startDate, elementId, "full"), 1000);
    }
  }

  // initial load
  updateDetailedTime("2025-04-22", "talk-days");
  updateDetailedTime("2025-08-03", "date-days");
  updateDetailedTime("2025-08-28", "love-days");

  /* ---------- Countdown cards (days visible) ---------- */
  function parseDateFromCard(card) {
    const abs = card.dataset.absolute;
    if (abs) {
      const d = new Date(abs);
      return isNaN(d) ? null : d;
    }
    const dd = card.dataset.date;
    if (!dd) return null;
    const [month, day] = dd.split('-').map(Number);
    const now = new Date();
    let target = new Date(now.getFullYear(), month - 1, day, 0, 0, 0, 0);
    if (target < now) target.setFullYear(now.getFullYear() + 1);
    return target;
  }

  function computeDaysRemaining(target) {
    const now = new Date();
    const diff = target - now;
    if (diff <= 0) return 0;
    const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
    return days;
  }

  function refreshCardsDays() {
    document.querySelectorAll('.card[data-date], .card[data-absolute]').forEach(card => {
      const target = parseDateFromCard(card);
      const daysEl = card.querySelector('.days');
      if (!daysEl) return;
      if (!target) {
        daysEl.textContent = '‚Äî';
        return;
      }
      const days = computeDaysRemaining(target);
      daysEl.textContent = (days === 0) ? 'Today!' : `${days} day${days === 1 ? '' : 's'}`;
    });
  }

  refreshCardsDays();
  setInterval(refreshCardsDays, 60 * 1000);

  function openModal(card) {
    const target = parseDateFromCard(card);
    if (!target) return;
    modalTitle.textContent = card.dataset.title || "";
    modalNote.textContent = card.dataset.note || "";
    if (timer) clearInterval(timer);

    const tick = () => {
      const diff = Math.max(0, target - new Date());
      const d = Math.floor(diff / (1000 * 60 * 60 * 24));
      const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const m = Math.floor((diff / (1000 * 60)) % 60);
      const s = Math.floor((diff / 1000) % 60);
      liveTime.textContent = `${String(d).padStart(2,'0')} : ${String(h).padStart(2,'0')} : ${String(m).padStart(2,'0')} : ${String(s).padStart(2,'0')}`;
    };

    tick();
    timer = setInterval(tick, 1000);
    modal.classList.add("open");
  }

  document.querySelectorAll('.card[data-date], .card[data-absolute]').forEach(card => {
    card.addEventListener("click", () => openModal(card));
  });

  closeBtn.addEventListener("click", () => {
    modal.classList.remove("open");
    if (timer) clearInterval(timer);
    timer = null;
  });
  modal.addEventListener("click", e => { if (e.target === modal) { modal.classList.remove("open"); if (timer) clearInterval(timer); timer = null; } });
  document.addEventListener("keydown", (e) => { if (e.key === "Escape" && modal.classList.contains("open")) { modal.classList.remove("open"); if (timer) clearInterval(timer); timer = null; } });

  /* ========== New: Gallery logic ========== */

  // Shared library of image sources (strings: either data-URL or normal URL)
  const imageLibrary = [];

  // The gallery container
  const galleryEl = document.getElementById('gallery');

  // Utility: create a gallery card and attach handlers
  function createGalleryCard(src) {
    const card = document.createElement('div');
    card.className = 'gallery-card';

    const img = document.createElement('img');
    img.src = src;
    img.alt = 'Gallery image';
    card.appendChild(img);

    const note = document.createElement('div');
    note.className = 'gallery-note';
    note.textContent = 'Tap to randomize';
    card.appendChild(note);

    // on click -> replace card image by a random image from library (not same)
    card.addEventListener('click', (e) => {
      if (imageLibrary.length <= 1) return; // nothing to change with
      // pick a random index different from the current image src
      let tries = 0;
      let candidate;
      const current = img.src;
      do {
        const i = Math.floor(Math.random() * imageLibrary.length);
        candidate = imageLibrary[i];
        tries++;
      } while (candidate === current && tries < 8);

      // If we somehow got same, choose next different one deterministically
      if (candidate === current) {
        for (let k = 0; k < imageLibrary.length; k++) {
          if (imageLibrary[k] !== current) { candidate = imageLibrary[k]; break; }
        }
      }

      // swap image on this card
      img.src = candidate;
    });

    return card;
  }

  // Render all images in library into gallery (clears and re-adds)
  function renderGallery() {
    galleryEl.innerHTML = '';
    imageLibrary.forEach(src => {
      const card = createGalleryCard(src);
      galleryEl.appendChild(card);
    });
  }

  // Add image(s) to library (array of src strings). Re-renders
  function addImagesToLibrary(sources) {
    for (const s of sources) {
      if (!s) continue;
      imageLibrary.push(s);
    }
    renderGallery();
  }

  /* ---------- File uploads (multiple) ---------- */
  const fileInput = document.getElementById('fileInput');
  // open picker when label clicked (label already wraps the input)
  fileInput.addEventListener('change', async (e) => {
    const files = Array.from(e.target.files || []);
    if (!files.length) return;
    const reads = files.map(file => {
      return new Promise((res) => {
        const r = new FileReader();
        r.onload = () => res(r.result);
        r.readAsDataURL(file);
      });
    });
    const results = await Promise.all(reads);
    addImagesToLibrary(results);
    // clear selection so same files can be re-uploaded if needed
    fileInput.value = '';
  });

  /* ---------- Add image by URL ---------- */
  const urlInput = document.getElementById('urlInput');
  const addUrlBtn = document.getElementById('addUrlBtn');
  addUrlBtn.addEventListener('click', () => {
    const url = urlInput.value.trim();
    if (!url) return;
    // Basic validation: has image extension or data: or begins with http
    if (!/^data:|^https?:\/\/.+\.(jpg|jpeg|png|gif|webp|avif)$/i.test(url) && !/^https?:\/\//i.test(url)) {
      // still allow generic URLs but warn in console
      console.warn('Adding URL that may not be an image:', url);
    }
    addImagesToLibrary([url]);
    urlInput.value = '';
  });

  // Basic UX: allow dropping images onto the gallery container
  galleryEl.addEventListener('dragover', (e) => { e.preventDefault(); galleryEl.style.opacity = 0.9; });
  galleryEl.addEventListener('dragleave', () => { galleryEl.style.opacity = 1; });
  galleryEl.addEventListener('drop', (e) => {
    e.preventDefault();
    galleryEl.style.opacity = 1;
    const dt = e.dataTransfer;
    const files = Array.from(dt.files || []).filter(f => f.type.startsWith('image/'));
    if (!files.length) return;
    const reads = files.map(f => new Promise(res => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.readAsDataURL(f);
    }));
    Promise.all(reads).then(results => addImagesToLibrary(results));
  });

  /* ---------- Optional: preload some images if you want ---------- */
  // Example: if you have images available by path on server, push them here.
  // addImagesToLibrary(['meeting.jpg','your-anniversary-image.jpg']); // uncomment & edit if desired

  // If you want the gallery to start with the images already used in cards on the page,
  // grab visible <img.card-img> sources and add them to the library (so initial library isn't empty).
  /* ------------------ Seed from images/image*.jpg (image, image1..image26) ------------------ */

// Helper: tries to load an image and resolves true/false
function testImageExists(url) {
  return new Promise((res) => {
    const t = new Image();
    t.onload = () => res(true);
    t.onerror = () => res(false);
    t.src = url;
  });
}

// Build candidate filenames and test them (you said image, image1..image26)
async function seedLibraryFromImagesFolder() {
  const candidates = [];
  // first try exact name "image.jpg"
  candidates.push('images/image.jpg');

  // then image1 .. image26 with extension .jpg
  for (let i = 1; i <= 26; i++) {
    candidates.push(`images/image${i}.jpg`);
  }

  // you might also have .png; test both extensions if you want:
  // if you use pngs, change the list above or add .png variants here.

  const ok = [];
  for (const c of candidates) {
    // only test same-origin images (they are on your Vercel domain, so OK)
    // this avoids showing broken images in the UI
    // tiny optimization: if file names are many, you can parallelize Promise.all
    // but here it's fine to do sequential to avoid spamming the server.
    // we'll check them in parallel but still guard errors:
    ok.push(testImageExists(c).then(found => found ? c : null));
  }

  const results = await Promise.all(ok);
  const valid = results.filter(Boolean); // keep only truthy (existing URLs)

  if (valid.length === 0) {
    // fallback: if the page already has card images (meeting, anniversary), keep them
    const cardImgs = Array.from(document.querySelectorAll('img.card-img')).map(i => i.src).filter(Boolean);
    if (cardImgs.length) {
      addImagesToLibrary(cardImgs);
    } else {
      // nothing found ‚Äî leave imageLibrary empty
      console.warn('No images found in images/ folder and no card-img seeds.');
    }
  } else {
    addImagesToLibrary(valid);
  }
}

// Renders a single gallery card (instead of many)
function renderSingleGalleryCard() {
  galleryEl.innerHTML = '';
  if (imageLibrary.length === 0) {
    // placeholder card if no images
    const placeholder = document.createElement('div');
    placeholder.className = 'gallery-card';
    placeholder.innerHTML = `<div style="padding:36px">No gallery images found.<br>Upload images to /images/ and push to GitHub.</div>`;
    galleryEl.appendChild(placeholder);
    return;
  }

  // Always show the first image initially (or random initial image)
  let currentIndex = Math.floor(Math.random() * imageLibrary.length);
  const card = document.createElement('div');
  card.className = 'gallery-card';

  const img = document.createElement('img');
  img.src = imageLibrary[currentIndex];
  img.alt = 'Gallery image';
  card.appendChild(img);

  const note = document.createElement('div');
  note.className = 'gallery-note';
  note.textContent = 'Tap to randomize';
  card.appendChild(note);

  // on click -> replace card image by a random image from library (not same)
  card.addEventListener('click', () => {
    if (imageLibrary.length <= 1) return;
    let tries = 0;
    let candidateIndex;
    do {
      candidateIndex = Math.floor(Math.random() * imageLibrary.length);
      tries++;
    } while (candidateIndex === currentIndex && tries < 12);
    if (candidateIndex === currentIndex) {
      // pick the next different deterministically
      candidateIndex = (currentIndex + 1) % imageLibrary.length;
    }
    currentIndex = candidateIndex;
    img.src = imageLibrary[currentIndex];
  });

  galleryEl.appendChild(card);
}

// Replace renderGallery() usage with this renderSingleGalleryCard() when seeding
// start:
seedLibraryFromImagesFolder().then(() => {
  // After seeding, render single card
  renderSingleGalleryCard();
});

  /* ========== Done ========== */
  </script>
</body>
</html>

