<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Kitten & Daddy üíñ</title>
  <style>
    /* =========================================
       1. CSS VARIABLES (THEME SYSTEM)
       ========================================= */
    :root {
      /* --- Default Pink Theme (Day) --- */
      --bg-color: #fffafc;
      --text-main: #3b3b3b;
      --text-sub: #6d6262;
      --heading-color: #e08eb4;
      --card-bg: #ffeef4;
      --card-border: #ffe0eb;
      --card-shadow: rgba(0, 0, 0, 0.1);
      --nav-bg: rgba(255, 255, 255, 0.95);
      --nav-border: #ffe0eb;
      --nav-icon-active: #ff7da5;
      --nav-icon-inactive: #ccc;
      --btn-bg: #ff7da5;
      --btn-text: #ffffff;
      --accent-green: #48bb78;
      --accent-red: #ff4757;
      --modal-bg: #ffffff;
      --envelope-front: #ff7da5;
      --envelope-back: #ffffff;
    }

    [data-theme="dark"] {
      /* --- Aesthetic Purple Theme (Night) --- */
      --bg-color: #130e24;         /* Deep Space Purple */
      --text-main: #e2d9f3;        /* Lavender White */
      --text-sub: #a79db8;         /* Muted Purple Gray */
      --heading-color: #d8b4fe;    /* Glowing Lilac */
      --card-bg: #231942;          /* Dark Violet Card */
      --card-border: #4c3b7a;      /* Lighter Purple Border */
      --card-shadow: rgba(139, 92, 246, 0.25); /* Purple Glow */
      --nav-bg: rgba(35, 25, 66, 0.9);
      --nav-border: #4c3b7a;
      --nav-icon-active: #c084fc;  /* Bright Violet */
      --nav-icon-inactive: #5c5470;
      --btn-bg: #7c3aed;           /* Deep Purple Button */
      --btn-text: #ffffff;
      --accent-green: #34d399;     /* Mint for dark mode */
      --accent-red: #fb7185;       /* Soft Red for dark mode */
      --modal-bg: #2d2455;
      --envelope-front: #7c3aed;
      --envelope-back: #1a1625;
    }

    /* =========================================
       2. GLOBAL STYLES
       ========================================= */
    body {
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background-color: var(--bg-color);
      color: var(--text-main);
      margin: 0;
      padding-bottom: 100px;
      text-align: center;
      overflow-x: hidden;
      transition: background-color 0.5s ease, color 0.5s ease;
      touch-action: manipulation;
    }
    h1 { font-size: 1.8rem; color: var(--heading-color); margin: 20px 0 10px; transition: color 0.5s; }
    h2, h3 { color: var(--heading-color); transition: color 0.5s; }
    p { color: var(--text-sub); transition: color 0.5s; }

    /* =========================================
       3. COMPONENT STYLES
       ========================================= */
    
    /* Header Image */
    .header-image img {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Cards (Countdowns & General) */
    .countdowns { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; padding: 10px; }
    .card {
      background-color: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 18px;
      box-shadow: 0 4px 12px var(--card-shadow);
      width: 45%;
      min-width: 150px;
      max-width: 220px;
      padding: 15px;
      transition: transform 0.25s ease, background-color 0.5s, border-color 0.5s, box-shadow 0.5s;
      cursor: pointer;
      margin-bottom: 10px;
    }
    .card:hover { transform: translateY(-4px); }
    .event { font-size: 1rem; color: var(--heading-color); font-weight: 600; margin-top: 5px; }
    .days { font-size: 1.5rem; color: var(--text-main); font-weight: 800; margin: 4px 0; }
    .note { font-size: .8rem; color: var(--text-sub); margin-top: 4px; }
    img.card-img { width: 100%; border-radius: 10px; margin-top: 8px; display: block; }

    /* Fun Cards */
    .fun-card {
      margin: 30px auto; 
      max-width: 320px; 
      background-color: var(--card-bg); 
      padding: 20px; 
      border-radius: 20px; 
      border: 2px solid var(--card-border);
      box-shadow: 0 4px 15px var(--card-shadow);
      transition: background-color 0.5s, border-color 0.5s;
    }

    /* Buttons */
    button, .interactive-btn {
        background-color: var(--btn-bg);
        color: var(--btn-text);
        border: none;
        padding: 10px 20px;
        border-radius: 50px;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
        font-family: inherit;
    }
    button:active { transform: scale(0.95); }

    /* Special Red Button Override */
    .emergency-btn {
        background: linear-gradient(135deg, #ff4757, #c0392b);
        color: white;
        display: block; 
        text-decoration: none; 
        padding: 15px; 
        border-radius: 12px; 
        font-weight: 800; 
        font-size: 1.2rem; 
        letter-spacing: 1px; 
        box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4); 
        text-transform: uppercase;
    }

    /* Navigation Bar */
    .nav-bar {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 95%;
      max-width: 450px;
      background: var(--nav-bg);
      backdrop-filter: blur(10px);
      padding: 10px 10px;
      border-radius: 50px;
      box-shadow: 0 10px 30px var(--card-shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      border: 1px solid var(--nav-border);
      transition: background-color 0.5s, border-color 0.5s;
    }
    .nav-item {
      font-size: 1.3rem;
      cursor: pointer;
      opacity: 0.6;
      transition: all 0.3s ease;
      background: none;
      border: none;
      padding: 5px;
      flex: 1;
      color: var(--nav-icon-inactive);
    }
    .nav-item.active {
      opacity: 1;
      transform: scale(1.1);
      color: var(--nav-icon-active);
    }
    .nav-label {
      font-size: 0.65rem;
      display: block;
      font-weight: bold;
      color: var(--heading-color);
    }

    /* Page Sections */
    .page-section { display: none; animation: fadeIn 0.5s ease; }
    .page-section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Rain Effect */
    .rain-container {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 9998; display: none;
    }
    .rain-container.active { display: block; }
    .rain-drop {
      position: absolute; bottom: 100%; width: 2px; height: 15px; 
      background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(137, 196, 244, 0.8)); 
      animation: fall linear infinite;
    }
    @keyframes fall { to { transform: translateY(110vh); } }

    /* Toggle Switch */
    .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    input:checked + .slider { background-color: var(--btn-bg); }
    input:checked + .slider:before { transform: translateX(24px); }

    /* Shredder Styles */
    .shredder-wrapper { position: relative; overflow: hidden; padding-bottom: 20px; }
    .shredder-input {
      width: 90%; padding: 12px; border: 2px solid var(--card-border); border-radius: 10px; font-family: inherit; resize: none; background: var(--bg-color); color: var(--text-main); transition: transform 1.5s cubic-bezier(0.4, 0.0, 0.2, 1); position: relative; z-index: 2;
    }
    .shredder-input.jammed { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; }
    .shredder-input.shredding { transform: translateY(150%); opacity: 0; }
    .shredder-machine-bar { height: 10px; background: var(--text-sub); width: 100%; border-radius: 5px; margin: 5px 0; position: relative; z-index: 5; }
    .paper-strip { position: absolute; top: 60px; width: 8px; height: 40px; background: var(--bg-color); border: 1px solid #ddd; z-index: 1; opacity: 0; }
    @keyframes shake {
      10%, 90% { transform: translate3d(-1px, 0, 0); }
      20%, 80% { transform: translate3d(2px, 0, 0); }
      30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
      40%, 60% { transform: translate3d(4px, 0, 0); }
    }
    @keyframes stripFall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(200px) rotate(var(--rot)); opacity: 0; }
    }

    /* Battery */
    .battery-container { width: 100%; height: 40px; border: 3px solid var(--text-main); border-radius: 10px; padding: 3px; box-sizing: border-box; margin-bottom: 10px; position: relative; }
    .battery-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #ff9a9e 0%, #fecfef 99%); border-radius: 5px; transition: width 0.1s; }
    .battery-cap { position: absolute; right: -8px; top: 10px; width: 5px; height: 14px; background: var(--text-main); border-radius: 0 3px 3px 0; }

    /* Modal */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,.38); display: none; align-items: center; justify-content: center; padding: 20px; z-index: 2000; }
    .modal.open { display: flex; }
    .modal-card { background: var(--modal-bg); max-width: 520px; width: 100%; border-radius: 20px; box-shadow: 0 12px 28px rgba(0,0,0,.3); padding: 26px 22px; border: 1px solid var(--card-border); }
    .bigtime { font-variant-numeric: tabular-nums; font-size: 2rem; font-weight: 800; color: var(--text-main); margin: 10px 0; }
    
    /* Envelope */
    .envelope-container { transition: transform 0.8s; }
    .open .envelope-container { transform: rotateY(180deg); }
    .envelope-front { background: var(--envelope-front); }
    .envelope-back { background: var(--envelope-back); border-color: var(--envelope-front); }
    
    /* Gallery */
    .gallery { display: flex; flex-direction: column; align-items: center; gap: 15px; padding: 10px; }
    .gallery-card { background: var(--card-bg); border-radius: 12px; padding: 8px; box-shadow: 0 4px 15px var(--card-shadow); width: 90%; max-width: 400px; }
    .gallery-card img { width: 100%; border-radius: 8px; }

    /* ==========================================
       NEW STYLES FOR FIDGETS (DISTRACTION ZONE)
       ========================================== */
    
    /* Foggy Window */
    .fog-wrapper { position: relative; width: 100%; height: 200px; background: #333; border-radius: 15px; overflow: hidden; cursor: crosshair; touch-action: none; }
    .fog-text { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: bold; color: #fff; z-index: 1; pointer-events: none; }
    canvas.fog-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; }

    /* Elastic Heart */
    .elastic-box { height: 250px; position: relative; background: var(--bg-color); border-radius: 15px; overflow: hidden; border: 2px dashed var(--card-border); touch-action: none; }
    .elastic-heart { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; cursor: grab; user-select: none; }
    .elastic-heart:active { cursor: grabbing; }

    /* Neon Scribble */
    .scribble-board { background: #000; border-radius: 15px; width: 100%; height: 250px; cursor: crosshair; touch-action: none; box-shadow: 0 0 10px rgba(0,0,0,0.5); }

    /* Gravity Box */
    .gravity-box { width: 100%; height: 250px; background: var(--bg-color); border: 2px solid var(--card-border); border-radius: 15px; position: relative; overflow: hidden; touch-action: none; }
    .gravity-emoji { position: absolute; font-size: 2rem; user-select: none; cursor: grab; }

  </style>
</head>
<body>

  <div id="rainContainer" class="rain-container"></div>
  
  <div class="header-image">
    <img src="i-love-you.jpg" alt="I Love You" />
  </div>

  <div id="page-home" class="page-section active">
    <h1>Our Countdowns ‚è≥</h1>

    <div class="countdowns">
      <div class="card" data-title="Our Anniversary üíû" data-date="09-06" data-note="Celebrating us üíå" data-img="your-anniversary-image.jpg">
        <div class="emoji">üíû</div>
        <div class="event">Anniversary</div>
        <div class="days"></div>
        <img class="card-img" src="your-anniversary-image.jpg" alt="Our Anniversary"/>
      </div>

      <div class="card" data-title="We meet!! üíû" data-absolute="2025-11-27T00:00:00" data-note="Together again üíñ" data-img="meeting.jpg">
        <div class="emoji">‚úàÔ∏è</div>
        <div class="event">We meet!!</div>
        <div class="days"></div>
        <img class="card-img" src="meeting.jpg" alt="Our Meeting"/>
      </div>
      
      <div class="card" data-title="End of Exams üìö" data-absolute="2025-12-30T23:59:59" data-note="Freedom! üå∑" data-img="exam-end.jpg">
        <div class="emoji">üìö</div>
        <div class="event">End of Exams</div>
        <div class="days"></div>
        <img class="card-img" src="exam-end.jpg" alt="End of Exams"/>
      </div>

      <div class="card" data-title="Kitten‚Äôs Birthday üéÇ" data-date="01-02" data-note="Happy Birthday!" data-img="kitten-birthday.jpg">
        <div class="emoji">üéÇ</div>
        <div class="event">Kitten Bday</div>
        <div class="days"></div>
        <img class="card-img" src="kitten-birthday.jpg" alt="Kitten Birthday"/>
      </div>

       <div class="card" data-title="Daddy‚Äôs Birthday üéâ" data-date="04-14" data-note="Muah!" data-img="daddy-birthday.jpg">
        <div class="emoji">üéâ</div>
        <div class="event">Daddy Bday</div>
        <div class="days"></div>
        <img class="card-img" src="daddy-birthday.jpg" alt="Daddy Birthday"/>
      </div>
    </div>

    <h2 style="margin-top: 20px;">‚ú® Milestones ‚ú®</h2>
    <div class="countdowns">
        <div class="card" style="width: 90%; max-width: 400px;" onclick="toggleDetail('talk', '2025-04-22')">
            <h3>üí¨ First Talked</h3>
            <p id="talk-days" style="font-size: 1.2rem; font-weight: bold; color: var(--heading-color);">Loading...</p>
        </div>
        <div class="card" style="width: 90%; max-width: 400px;" onclick="toggleDetail('date', '2025-08-03')">
            <h3>üç∞ First Date</h3>
            <p id="date-days" style="font-size: 1.2rem; font-weight: bold; color: var(--heading-color);">Loading...</p>
        </div>
        <div class="card" style="width: 90%; max-width: 400px;" onclick="toggleDetail('love', '2025-08-28')">
            <h3>‚ù§Ô∏è Said "I Love You"</h3>
            <p id="love-days" style="font-size: 1.2rem; font-weight: bold; color: var(--heading-color);">Loading...</p>
        </div>
    </div>
  </div>


  <div id="page-notes" class="page-section">
    <h1>Love Notes üíå</h1>

    <div class="card" style="width: 90%; max-width: 400px; margin: 0 auto 30px; cursor: default;" onclick="generateRandomNote()">
        <div class="emoji">üé≤</div>
        <div class="event">Tap for a Random Note</div>
        <div id="note-content" class="note-display-area">Tap me!</div>
    </div>

    <div style="margin: 50px auto; perspective: 1000px; cursor: pointer; width: 280px; height: 180px;" onclick="this.classList.toggle('open')">
        <div class="envelope-container" style="position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d;">
          <div class="envelope-front" style="position: absolute; width: 100%; height: 100%; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; backface-visibility: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.15);">
            üíå <div style="position: absolute; bottom: 10px; font-size: 0.9rem;">Tap to Open</div>
          </div>
          <div class="envelope-back" style="position: absolute; width: 100%; height: 100%; border: 2px solid; border-radius: 10px; transform: rotateY(180deg); padding: 20px; box-sizing: border-box; overflow-y: auto; text-align: left; display: flex; flex-direction: column; backface-visibility: hidden;">
            <h4 style="margin: 0 0 10px;">To my Khushi,</h4>
            <p style="font-size: 0.85rem; line-height: 1.4; margin: 0;">
              I know exams are tough, but you are tougher. I am so incredibly proud of you. Just remember to drink water and take breaks. I am always right here! <br><br> Love, Your Kitten.
            </p>
          </div>
        </div>
    </div>

    <h2 style="margin-top: 40px;">Open When...</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 0 20px;">
        <button onclick="alert('Everything will be okay. Take a deep breath. I believe in you! üåü')">You're Stressed üò∞</button>
        <button onclick="alert('I am so proud of you. You are working so hard and it shows! Keep going! üí™')">Need Motivation üò§</button>
        <button onclick="alert('Go look in the mirror. You are literally the prettiest girl ever. Don\'t argue. ü™û')">Feeling Insecure üò£</button>
    </div>
    
    <div class="fun-card">
        <h3 style="text-align: center; margin-top: 0;">Daily To-Do ‚úÖ</h3>
        <label style="display: block; margin: 10px 0; color: var(--text-main);"><input type="checkbox" style="accent-color: var(--btn-bg); margin-right: 10px;"> call me </label>
        <label style="display: block; margin: 10px 0; color: var(--text-main);"><input type="checkbox" style="accent-color: var(--btn-bg); margin-right: 10px;"> miss me ‚ù§Ô∏è</label>
        <label style="display: block; margin: 10px 0; color: var(--text-main);"><input type="checkbox" style="accent-color: var(--btn-bg); margin-right: 10px;"> Drink water üíß</label>
    </div>
  </div>


  <div id="page-fun" class="page-section">
    <h1>Fun Zone üß∏</h1>
    
    <div class="fun-card" style="display: flex; align-items: center; justify-content: space-between; padding: 15px 25px;">
      <h3 style="color: #89c4f4; margin: 0; font-size: 1.1rem;">Soft Rain Mode üåßÔ∏è</h3>
      <label class="toggle-switch">
        <input type="checkbox" id="rainToggle">
        <span class="slider"></span>
      </label>
    </div>

    <div class="fun-card" style="display: flex; align-items: center; justify-content: space-between; padding: 15px 25px;">
      <h3 style="color: #a78bfa; margin: 0; font-size: 1.1rem;">Dark mode üåô</h3>
      <label class="toggle-switch">
        <input type="checkbox" id="themeToggle">
        <span class="slider" style="background-color: #ddd;"></span>
      </label>
    </div>

    <div class="fun-card">
      <h3 style="color: #a67fb8; margin-top: 0;">Pet the Kitten üê±</h3>
      <p style="font-size: 0.8rem;">Rub the cat to make it happy!</p>
      <div id="petZone" style="font-size: 5rem; cursor: grab; user-select: none; transition: transform 0.1s;" 
           onmousemove="petCat(event)" ontouchmove="petCat(event)">üê±</div>
      <p id="purrStatus" style="font-size: 0.9rem; color: #a67fb8; min-height: 20px;">...</p>
    </div>

    <div class="fun-card" style="border-color: var(--accent-green);">
      <h3 style="color: var(--accent-green); margin-top: 0;">Our Love Plant üå±</h3>
      <p style="font-size: 0.8rem;">Water it daily to see it bloom!</p>
      <div id="plantStage" style="font-size: 5rem; min-height: 100px; transition: all 0.5s ease; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));">ü´ò</div>
      <p id="plantStatus" style="font-size: 0.9rem; color: var(--accent-green); font-weight: 600;">Stage 1: A tiny seed.</p>
      <button id="waterBtn" onclick="waterPlant()" style="background: var(--accent-green); color: white; box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);">üíß Water Plant</button>
    </div>

    <div class="fun-card" style="border-color: var(--accent-red);">
      <h3 style="color: var(--accent-red); margin-top: 0;">EMERGENCY üö®</h3>
      <p style="font-size: 0.8rem;">Only press if you need me ASAP!</p>
      <a href="https://wa.me/7974776697?text=CODE%20RED!%20üö®%20Baby%20I%20need%20attention%20immediately!%20ü•∫" target="_blank" class="emergency-btn">BREAK GLASS üî®</a>
    </div>

    <div class="fun-card">
      <h3 style="margin-top: 0;">Worry Shredder üóëÔ∏è</h3>
      <p style="font-size: 0.8rem;">Type the stress, then watch it disappear.</p>
      <div class="shredder-wrapper" id="shredderContainer">
        <textarea id="worryInput" class="shredder-input" rows="3" placeholder="Exams, distance, overthinking..."></textarea>
        <div class="shredder-machine-bar"></div>
      </div>
      <button onclick="shredWorry(this)" style="margin-top:10px; position: relative; z-index: 20;">Shred it! üí•</button>
    </div>

    <div class="fun-card">
      <h3 style="margin-top: 0;">Love Battery üîã</h3>
      <p style="font-size: 0.8rem;">Low energy? Hold the button to recharge!</p>
      <div class="battery-container">
        <div class="battery-cap"></div>
        <div id="batteryFill" class="battery-fill"></div>
      </div>
      <button id="chargeBtn" style="user-select: none;">Hold Me! ‚ö°</button>
    </div>

    <div style="margin: 30px auto; text-align: center; max-width: 300px;">
        <h3 style="color: var(--heading-color);">Breathe with me üßò‚Äç‚ôÄÔ∏è</h3>
        <div style="margin: 30px auto; height: 120px; display: flex; align-items: center; justify-content: center;">
          <div class="breathing-heart">
            <svg viewBox="0 0 32 29.6" style="width: 100%; height: 100%; overflow: visible;">
              <path d="M23.6,0c-3.4,0-6.3,2.7-7.6,5.6C14.7,2.7,11.8,0,8.4,0C3.8,0,0,3.8,0,8.4c0,9.4,9.5,11.9,16,21.2c6.1-9.3,16-11.8,16-21.2C32,3.8,28.2,0,23.6,0z" fill="#ff7da5"/>
              <text x="16" y="15" fill="white" font-size="7" font-weight="bold" text-anchor="middle" dominant-baseline="middle">R & K</text>
            </svg>
          </div>
        </div>
        <style>.breathing-heart { width: 100px; height: 100px; animation: breatheHeart 4s ease-in-out infinite; transform-origin: center; } @keyframes breatheHeart { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); } }</style>
    </div>

    <div style="margin: 40px auto; text-align: center;">
        <button id="kissBtn" style="font-size: 1.5rem;">Send a Kiss üíã</button>
        <p style="margin-top: 10px; font-size: 0.9rem;">Total Kisses Sent: <span id="kissCount" style="color: var(--heading-color); font-weight: bold;">0</span></p>
    </div>
  </div>


  <div id="page-fidgets" class="page-section">
    <h1>Distraction Zone üß©</h1>
    <p style="font-size: 0.9rem; margin-bottom: 20px;">Play with these when you're stressed!</p>

    <div class="fun-card">
        <h3 style="margin-top: 0;">Foggy Window üå´Ô∏è</h3>
        <p style="font-size: 0.8rem;">Rub the window to reveal the message!</p>
        <div class="fog-wrapper">
            <div class="fog-text">hehe </div>
            <canvas id="fogCanvas"></canvas>
        </div>
    </div>

    <div class="fun-card">
        <h3 style="margin-top: 0;">Elastic Heart üèπ</h3>
        <p style="font-size: 0.8rem;">Pull the heart and snap it back!</p>
        <div id="elasticBox" class="elastic-box">
            <div id="elasticHeart" class="elastic-heart">‚ù§Ô∏è</div>
        </div>
    </div>

    <div class="fun-card">
        <h3 style="margin-top: 0;">Gravity Box üçé</h3>
        <p style="font-size: 0.8rem;">Tap anywhere inside to shake them up!</p>
        <div id="gravityBox" class="gravity-box"></div>
    </div>

    <div class="fun-card">
        <h3 style="margin-top: 0;">Neon Scribble üñäÔ∏è</h3>
        <p style="font-size: 0.8rem;">Draw light that fades away...</p>
        <canvas id="scribbleCanvas" class="scribble-board"></canvas>
    </div>

    <div class="fun-card">
        <h3 style="margin-top: 0;">Confetti Cannon üéâ</h3>
        <button onclick="fireConfetti()" style="font-size: 1.2rem; padding: 15px 30px;">BOOM! üí•</button>
    </div>

    <div class="fun-card">
      <h3 style="margin-top: 0;">Fidget Switches üéöÔ∏è</h3>
      <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 15px;">
        <label class="toggle-switch"><input type="checkbox"><span class="slider"></span></label>
        <label class="toggle-switch"><input type="checkbox" checked><span class="slider"></span></label>
        <label class="toggle-switch"><input type="checkbox"><span class="slider"></span></label>
        <label class="toggle-switch"><input type="checkbox" checked><span class="slider"></span></label>
      </div>
    </div>
    
    <div style="margin: 40px auto; max-width: 300px;">
        <h3 style="color: var(--heading-color);">Stress Popping ü´ß</h3>
        <div id="bubble-grid" style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;"></div>
    </div>
  </div>


  <div id="page-gallery" class="page-section">
    <h1>Photo Gallery üì∏</h1>
    <div id="gallery" class="gallery">
        </div>
  </div>


  <nav class="nav-bar">
    <button class="nav-item active" onclick="showPage('page-home', this)">
        <span class="nav-icon">üè†</span>
        <span class="nav-label">Home</span>
    </button>
    <button class="nav-item" onclick="showPage('page-notes', this)">
        <span class="nav-icon">üíå</span>
        <span class="nav-label">Notes</span>
    </button>
    <button class="nav-item" onclick="showPage('page-fun', this)">
        <span class="nav-icon">üß∏</span>
        <span class="nav-label">Fun</span>
    </button>
    <button class="nav-item" onclick="showPage('page-fidgets', this)">
        <span class="nav-icon">üß©</span>
        <span class="nav-label">Fidgets</span>
    </button>
    <button class="nav-item" onclick="showPage('page-gallery', this)">
        <span class="nav-icon">üì∏</span>
        <span class="nav-label">Photos</span>
    </button>
  </nav>

  <div class="modal" id="modal">
    <div class="modal-card">
      <h3 class="modal-title" id="modalTitle"></h3>
      <p class="modal-sub" id="modalNote"></p>
      <div class="bigtime" id="liveTime"></div>
      <div class="units">Days : Hours : Minutes : Seconds</div>
      <button class="modal-close" id="closeBtn">Close</button>
    </div>
  </div>

  <script>
    /* --- THEME TOGGLE LOGIC --- */
    const themeToggle = document.getElementById('themeToggle');
    if(themeToggle) {
        themeToggle.addEventListener('change', function() {
            if(this.checked) { document.body.setAttribute('data-theme', 'dark'); } 
            else { document.body.removeAttribute('data-theme'); }
        });
    }

    /* --- NAVIGATION LOGIC --- */
    function showPage(pageId, btn) {
        document.querySelectorAll('.page-section').forEach(page => page.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        btn.classList.add('active');
        window.scrollTo(0,0);
        
        // Re-init canvases if fidget page is shown
        if(pageId === 'page-fidgets') {
            initFog();
            initScribble();
            if(!gravityInterval) initGravityBox();
        }
    }

    /* --- RANDOM LOVE NOTES --- */
    const myNotes = [
        "your doing amazing", "you scored 8.5 cgpa last sem!!!!", 
        "your lowest marks are literally 80%", "mera smarty bhondu", 
        "dont procrastinate", "you already have a mental map, just keep going", 
        "i love you"
    ];
    function generateRandomNote() {
        const container = document.getElementById("note-content");
        const r = Math.random();
        if (r < 0.1) { 
            container.innerHTML = `<div>kaun hai meri pyaari si girlfriend?</div><button class="interactive-btn" onclick="event.stopPropagation(); this.parentElement.innerHTML='haan, meri pyaari khushi hai!! ü•∞'">khushi hai!!</button>`;
        } else if (r < 0.2) {
            container.innerHTML = `<div>muahhh! üòΩ</div><button class="interactive-btn" onclick="event.stopPropagation(); this.parentElement.innerHTML='muahhh back! üíï'">muahhh</button>`;
        } else {
            const randomIndex = Math.floor(Math.random() * myNotes.length);
            container.innerText = myNotes[randomIndex];
        }
    }

    /* --- BUBBLE WRAP --- */
    const bubbleGrid = document.getElementById('bubble-grid');
    for(let i=0; i<15; i++) {
        const bubble = document.createElement('div');
        bubble.style.cssText = `width: 40px; height: 40px; background: #ffe0eb; border-radius: 50%; cursor: pointer; box-shadow: inset -2px -2px 6px rgba(0,0,0,0.1); transition: transform 0.1s;`;
        bubble.onclick = function() {
            if (this.style.opacity !== '0') {
                this.style.transform = 'scale(1.2)'; this.style.backgroundColor = '#fff';
                setTimeout(() => { this.style.transform = 'scale(0)'; this.style.opacity = '0'; }, 100);
            }
        };
        bubbleGrid.appendChild(bubble);
    }

    /* --- KISS COUNTER --- */
    const kissBtn = document.getElementById('kissBtn');
    const kissCountDisplay = document.getElementById('kissCount');
    let kisses = localStorage.getItem('kissCount') || 0;
    kissCountDisplay.textContent = kisses;
    kissBtn.addEventListener('click', () => {
        kisses++; localStorage.setItem('kissCount', kisses); kissCountDisplay.textContent = kisses;
        kissBtn.style.transform = 'scale(0.95)'; setTimeout(() => kissBtn.style.transform = 'scale(1)', 100);
    });

    /* --- LOVE BATTERY --- */
    const chargeBtn = document.getElementById('chargeBtn');
    const batteryFill = document.getElementById('batteryFill');
    let charge = 0;
    let chargeInterval;

    chargeBtn.addEventListener('mousedown', startCharge);
    chargeBtn.addEventListener('touchstart', startCharge);
    chargeBtn.addEventListener('mouseup', stopCharge);
    chargeBtn.addEventListener('touchend', stopCharge);

    function startCharge(e) {
        e.preventDefault();
        chargeBtn.style.transform = 'scale(0.95)';
        if (charge >= 100) { charge = 0; batteryFill.style.width = '0%'; batteryFill.style.background = 'linear-gradient(90deg, #ff9a9e 0%, #fecfef 99%)'; }
        
        chargeInterval = setInterval(() => {
            charge += 2;
            batteryFill.style.width = charge + '%';
            if (charge >= 100) {
                clearInterval(chargeInterval);
                batteryFill.style.background = '#7dff93'; // Green when full
                chargeBtn.innerText = "Fully Charged! ‚ö°";
            }
        }, 50);
    }
    function stopCharge() {
        clearInterval(chargeInterval);
        chargeBtn.style.transform = 'scale(1)';
        if (charge < 100) chargeBtn.innerText = "Hold Me! ‚ö°";
    }

    /* --- FLOATING HEARTS --- */
    function createHeart() {
        const heart = document.createElement('div');
        heart.innerHTML = 'üíñ'; 
        heart.style.position = 'fixed'; heart.style.left = Math.random() * 100 + 'vw'; heart.style.bottom = '-20px'; heart.style.fontSize = Math.random() * 20 + 10 + 'px'; heart.style.zIndex = '0'; heart.style.animation = 'floatUp 5s linear'; heart.style.opacity = '0.6';
        document.body.appendChild(heart);
        setTimeout(() => { heart.remove(); }, 5000);
    }
    const styleSheet = document.createElement("style");
    styleSheet.innerText = `@keyframes floatUp { to { transform: translateY(-100vh); opacity: 0; } }`;
    document.head.appendChild(styleSheet);
    setInterval(createHeart, 600);

    /* --- COUNTDOWN LOGIC --- */
    const modal = document.getElementById("modal");
    const modalTitle = document.getElementById("modalTitle");
    const modalNote = document.getElementById("modalNote");
    const liveTime = document.getElementById("liveTime");
    const closeBtn = document.getElementById("closeBtn");
    let timer = null;
    const intervals = {};

    function updateDetailedTime(startDate, elementId, mode = "days") {
        const start = new Date(startDate); const now = new Date(); const diff = now - start;
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const element = document.getElementById(elementId);
        if (!element) return;
        element.textContent = mode === "days" ? `${days} days üí´` : `${days}d ${Math.floor((diff/(1000*60*60))%24)}h ${Math.floor((diff/(1000*60))%60)}m ${Math.floor((diff/1000)%60)}s`;
    }
    function toggleDetail(type, startDate) {
        const elementId = `${type}-days`;
        if (intervals[type]) { clearInterval(intervals[type]); intervals[type] = null; updateDetailedTime(startDate, elementId, "days"); }
        else { updateDetailedTime(startDate, elementId, "full"); intervals[type] = setInterval(() => updateDetailedTime(startDate, elementId, "full"), 1000); }
    }
    updateDetailedTime("2025-04-22", "talk-days");
    updateDetailedTime("2025-08-03", "date-days");
    updateDetailedTime("2025-08-28", "love-days");

    function parseDateFromCard(card) {
        const abs = card.dataset.absolute; if (abs) return new Date(abs);
        const dd = card.dataset.date; if (!dd) return null;
        const [m, d] = dd.split('-').map(Number); const now = new Date();
        let target = new Date(now.getFullYear(), m - 1, d);
        if (target < now) target.setFullYear(now.getFullYear() + 1);
        return target;
    }
    function refreshCardsDays() {
        document.querySelectorAll('.card[data-date], .card[data-absolute]').forEach(card => {
            const target = parseDateFromCard(card);
            const daysEl = card.querySelector('.days');
            if (daysEl && target) {
                const diff = target - new Date();
                const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
                daysEl.textContent = (days <= 0) ? 'Today!' : `${days} day${days===1?'':'s'}`;
            }
        });
    }
    refreshCardsDays(); setInterval(refreshCardsDays, 60000);

    function openModal(card) {
        const target = parseDateFromCard(card); if (!target) return;
        modalTitle.textContent = card.dataset.title || ""; modalNote.textContent = card.dataset.note || "";
        if (timer) clearInterval(timer);
        const tick = () => {
            const diff = Math.max(0, target - new Date());
            liveTime.textContent = `${Math.floor(diff/(1000*60*60*24))} : ${String(Math.floor((diff/(1000*60*60))%24)).padStart(2,'0')} : ${String(Math.floor((diff/(1000*60))%60)).padStart(2,'0')} : ${String(Math.floor((diff/1000)%60)).padStart(2,'0')}`;
        };
        tick(); timer = setInterval(tick, 1000); modal.classList.add("open");
    }
    document.querySelectorAll('.card[data-date], .card[data-absolute]').forEach(card => card.addEventListener("click", () => openModal(card)));
    closeBtn.addEventListener("click", () => { modal.classList.remove("open"); if (timer) clearInterval(timer); });
    
    /* --- GALLERY LOGIC --- */
    const galleryEl = document.getElementById('gallery');
    const imageLibrary = [];
    
    function testImageExists(url) { return new Promise((res) => { const t = new Image(); t.onload = () => res(true); t.onerror = () => res(false); t.src = url; }); }
    
    async function seedGallery() {
        const candidates = ['images/image.jpg'];
        for(let i=1; i<=26; i++) candidates.push(`images/image${i}.jpg`);
        
        const promises = candidates.map(c => testImageExists(c).then(exists => exists ? c : null));
        const results = await Promise.all(promises);
        const valid = results.filter(Boolean);
        
        if (valid.length === 0) {
             const cardImgs = Array.from(document.querySelectorAll('img.card-img')).map(i => i.src).filter(Boolean);
             if(cardImgs.length) { imageLibrary.push(...cardImgs); renderSingleGalleryCard(); }
             else { galleryEl.innerHTML = '<div style="padding:20px">No images found in images/ folder.</div>'; }
        } else {
             imageLibrary.push(...valid);
             renderSingleGalleryCard();
        }
    }

    function renderSingleGalleryCard() {
        galleryEl.innerHTML = '';
        if (imageLibrary.length === 0) return;
        let currentIndex = Math.floor(Math.random() * imageLibrary.length);
        const card = document.createElement('div');
        card.className = 'gallery-card';
        const img = document.createElement('img');
        img.src = imageLibrary[currentIndex];
        card.appendChild(img);
        const note = document.createElement('div');
        note.style.fontSize = '0.8rem'; note.style.marginTop = '5px'; note.textContent = 'Tap for next pic üì∏';
        card.appendChild(note);
        card.onclick = () => {
            let nextIndex;
            do { nextIndex = Math.floor(Math.random() * imageLibrary.length); } 
            while (nextIndex === currentIndex && imageLibrary.length > 1);
            currentIndex = nextIndex;
            img.src = imageLibrary[currentIndex];
        };
        galleryEl.appendChild(card);
    }
    seedGallery();

    /* --- VIRTUAL PLANT LOGIC --- */
    const plantStages = [
      { emoji: "ü´ò", text: "Stage 1: A tiny seed of our love." },
      { emoji: "üå±", text: "Stage 2: It sprout! It likes your attention." },
      { emoji: "ü™¥", text: "Stage 3: Growing strong, just like us." },
      { emoji: "üåø", text: "Stage 4: Look how big it is!" },
      { emoji: "üå∏", text: "Stage 5: It bloomed for you! Beautiful! üíñ" }
    ];
    const plantStageEl = document.getElementById('plantStage');
    const plantStatusEl = document.getElementById('plantStatus');
    const waterBtn = document.getElementById('waterBtn');
    let currentStage = parseInt(localStorage.getItem('plantStage')) || 0;
    let lastWateredDate = localStorage.getItem('lastWateredDate');

    function updatePlantVisuals() {
      const stageData = plantStages[Math.min(currentStage, plantStages.length - 1)];
      if (plantStageEl) {
        plantStageEl.innerHTML = stageData.emoji;
        plantStageEl.style.transform = "scale(1.2)";
        setTimeout(() => { plantStageEl.style.transform = "scale(1)"; }, 300);
      }
      if (plantStatusEl) plantStatusEl.textContent = stageData.text;
      const today = new Date().toISOString().slice(0, 10);
      if (lastWateredDate === today && currentStage < plantStages.length) {
         waterBtn.disabled = true; waterBtn.innerText = "Come back tomorrow! üïí"; waterBtn.style.background = "#ccc"; waterBtn.style.boxShadow = "none";
      } else if (currentStage >= plantStages.length) {
         waterBtn.disabled = true; waterBtn.innerText = "Fully Bloomed! üå∏";
      }
    }
    function waterPlant() {
      const today = new Date().toISOString().slice(0, 10);
      if (lastWateredDate === today) { alert("You already watered it today! Don't overwater our love! üòâ"); return; }
      if (currentStage < plantStages.length) {
        currentStage++;
        if(currentStage === plantStages.length) alert("OMG! You made it bloom! I love you! üå∏üíñüå∏");
      }
      lastWateredDate = today;
      localStorage.setItem('plantStage', currentStage);
      localStorage.setItem('lastWateredDate', lastWateredDate);
      updatePlantVisuals();
    }
    if (waterBtn) updatePlantVisuals();

    /* --- RAIN LOGIC --- */
    const rainToggle = document.getElementById('rainToggle');
    const rainContainer = document.getElementById('rainContainer');
    let rainInterval;
    if (rainToggle) {
        rainToggle.addEventListener('change', function() {
          if(this.checked) {
            rainContainer.classList.add('active');
            rainInterval = setInterval(() => {
              const drop = document.createElement('div');
              drop.className = 'rain-drop';
              drop.style.left = Math.random() * 100 + 'vw';
              drop.style.animationDuration = Math.random() * 1 + 0.5 + 's';
              drop.style.opacity = Math.random();
              rainContainer.appendChild(drop);
              setTimeout(() => { drop.remove(); }, 2000);
            }, 50); 
          } else {
            rainContainer.classList.remove('active');
            clearInterval(rainInterval);
            rainContainer.innerHTML = '';
          }
        });
    }

    /* --- PET CAT LOGIC --- */
    let lastPetTime = 0;
    function petCat(e) {
      const now = Date.now();
      if (now - lastPetTime < 50) return;
      lastPetTime = now;
      const cat = document.getElementById('petZone');
      const status = document.getElementById('purrStatus');
      cat.style.transform = `rotate(${Math.random() * 20 - 10}deg) scale(1.1)`;
      setTimeout(() => cat.style.transform = 'rotate(0deg) scale(1)', 100);
      const purrs = ["Purr...", "Meow!", "Mrrrph~", "‚ù§Ô∏è"];
      status.innerText = purrs[Math.floor(Math.random() * purrs.length)];
      const heart = document.createElement('div');
      heart.innerText = '‚ù§Ô∏è';
      heart.style.position = 'absolute';
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      heart.style.left = (clientX - 10) + 'px'; heart.style.top = (clientY - 20) + 'px'; heart.style.pointerEvents = 'none'; heart.style.fontSize = '1.5rem'; heart.style.transition = 'all 0.8s ease-out';
      document.body.appendChild(heart);
      requestAnimationFrame(() => { heart.style.transform = `translateY(-100px) translateX(${Math.random() * 40 - 20}px)`; heart.style.opacity = 0; });
      setTimeout(() => heart.remove(), 800);
    }

    /* --- SHREDDER LOGIC --- */
    function shredWorry(btn) {
      const input = document.getElementById('worryInput');
      const container = document.getElementById('shredderContainer');
      if (!input.value.trim()) { alert("Write something first! üòâ"); return; }
      btn.disabled = true; btn.innerText = "Shredding...";
      input.classList.add('jammed');
      setTimeout(() => {
        input.classList.remove('jammed'); input.classList.add('shredding');
        for(let i=0; i<30; i++) {
          const strip = document.createElement('div');
          strip.className = 'paper-strip';
          strip.style.left = (i * 3 + Math.random() * 5) + '%';
          strip.style.setProperty('--rot', (Math.random() * 360) + 'deg');
          strip.style.animation = `stripFall ${1 + Math.random()}s forwards`;
          container.appendChild(strip);
          setTimeout(() => strip.remove(), 2000);
        }
      }, 500);
      setTimeout(() => {
        input.value = ''; input.classList.remove('shredding'); btn.disabled = false; btn.innerText = "Shred it! üí•";
      }, 2500);
    }

    /* =============================================
       NEW FIDGETS LOGIC
       ============================================= */
    
    /* 1. FOGGY WINDOW */
    function initFog() {
        const canvas = document.getElementById('fogCanvas');
        if(!canvas) return;
        const ctx = canvas.getContext('2d');
        const wrapper = canvas.parentElement;
        canvas.width = wrapper.offsetWidth;
        canvas.height = wrapper.offsetHeight;
        
        // Fill with gray
        ctx.fillStyle = '#999';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalCompositeOperation = 'destination-out';

        function scratch(x, y) {
            ctx.beginPath();
            ctx.arc(x, y, 20, 0, Math.PI * 2);
            ctx.fill();
        }

        canvas.onmousemove = (e) => {
            const rect = canvas.getBoundingClientRect();
            scratch(e.clientX - rect.left, e.clientY - rect.top);
        };
        canvas.ontouchmove = (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            scratch(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top);
        };
    }

    /* 2. ELASTIC HEART */
    const heart = document.getElementById('elasticHeart');
    const box = document.getElementById('elasticBox');
    if(heart && box) {
        let isDragging = false;
        const center = { x: box.offsetWidth/2, y: box.offsetHeight/2 };
        
        const startDrag = () => { isDragging = true; heart.style.transition = 'none'; };
        const endDrag = () => { 
            isDragging = false; 
            heart.style.transition = 'all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            heart.style.top = '50%'; 
            heart.style.left = '50%'; 
        };
        const moveDrag = (x, y) => {
            if(!isDragging) return;
            const rect = box.getBoundingClientRect();
            let localX = x - rect.left;
            let localY = y - rect.top;
            heart.style.left = localX + 'px';
            heart.style.top = localY + 'px';
        };

        heart.addEventListener('mousedown', startDrag);
        heart.addEventListener('touchstart', startDrag);
        window.addEventListener('mouseup', endDrag);
        window.addEventListener('touchend', endDrag);
        box.addEventListener('mousemove', e => moveDrag(e.clientX, e.clientY));
        box.addEventListener('touchmove', e => moveDrag(e.touches[0].clientX, e.touches[0].clientY));
    }

    /* 3. NEON SCRIBBLE */
    function initScribble() {
        const canvas = document.getElementById('scribbleCanvas');
        if(!canvas) return;
        const ctx = canvas.getContext('2d');
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
        ctx.lineWidth = 4;
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#ff00de';
        ctx.strokeStyle = '#ff00de';

        let painting = false;
        function startPosition() { painting = true; }
        function finishedPosition() { painting = false; ctx.beginPath(); }
        function draw(x, y) {
            if(!painting) return;
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        canvas.onmousedown = startPosition;
        canvas.onmouseup = finishedPosition;
        canvas.onmousemove = e => {
            const r = canvas.getBoundingClientRect();
            draw(e.clientX - r.left, e.clientY - r.top);
        };
        canvas.ontouchstart = (e) => { e.preventDefault(); startPosition(); };
        canvas.ontouchend = finishedPosition;
        canvas.ontouchmove = e => {
            e.preventDefault();
            const r = canvas.getBoundingClientRect();
            draw(e.touches[0].clientX - r.left, e.touches[0].clientY - r.top);
        };

        // Fade effect loop
        setInterval(() => {
            ctx.save();
            ctx.globalCompositeOperation = 'destination-out';
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.restore();
        }, 50);
    }

    /* 4. GRAVITY BOX (Updated Physics) */
    let gravityInterval;
    const emojis = ['‚ù§Ô∏è', 'üçé', 'üê±', 'üåü', 'üëª', 'üç™', 'üß∏'];
    const bodies = [];
    
    function initGravityBox() {
        const box = document.getElementById('gravityBox');
        if(!box) return;
        
        // Clear existing if re-initializing
        box.innerHTML = ''; 
        bodies.length = 0;
        if(gravityInterval) clearInterval(gravityInterval);
        
        // Create 12 random emojis
        for(let i=0; i<12; i++) {
            const el = document.createElement('div');
            el.className = 'gravity-emoji';
            el.innerText = emojis[Math.floor(Math.random()*emojis.length)];
            // Random initial position
            const startX = Math.random() * (box.offsetWidth - 40);
            const startY = Math.random() * (box.offsetHeight / 2);
            
            box.appendChild(el);
            bodies.push({
                el: el,
                x: startX,
                y: startY,
                vx: (Math.random() - 0.5) * 15, // Horizontal velocity
                vy: (Math.random() - 0.5) * 15  // Vertical velocity
            });
        }

        // Physics Loop
        gravityInterval = setInterval(() => {
            bodies.forEach(b => {
                b.vy += 0.8; // Gravity strength
                b.x += b.vx;
                b.y += b.vy;

                // Friction (Air resistance)
                b.vx *= 0.99;
                b.vy *= 0.99;

                // Floor Collision
                if(b.y + 40 > box.offsetHeight) { 
                    b.y = box.offsetHeight - 40; 
                    b.vy *= -0.6; // Bounce efficiency (loss of energy)
                    // Randomize horizontal bounce slightly on floor hit
                    b.vx += (Math.random() - 0.5) * 2;
                }
                
                // Ceiling Collision
                if(b.y < 0) { 
                    b.y = 0; 
                    b.vy *= -0.6; 
                }
                
                // Right Wall Collision
                if(b.x + 40 > box.offsetWidth) { 
                    b.x = box.offsetWidth - 40; 
                    b.vx *= -0.6; 
                }
                
                // Left Wall Collision
                if(b.x < 0) { 
                    b.x = 0; 
                    b.vx *= -0.6; 
                }

                b.el.style.transform = `translate(${b.x}px, ${b.y}px)`;
            });
        }, 20);
        
        // Interaction: Tap to "Explode" / Shake
        const boost = (e) => {
            e.preventDefault(); // Stop scrolling on touch
            bodies.forEach(b => {
                // Give them a massive random kick upwards and sideways
                b.vy = -15 - (Math.random() * 10);
                b.vx = (Math.random() - 0.5) * 30;
            });
        };

        box.addEventListener('mousedown', boost);
        box.addEventListener('touchstart', boost);
    }

    /* 5. CONFETTI CANNON */
    function fireConfetti() {
        const colors = ['#ff7da5', '#48bb78', '#ff4757', '#feca57', '#54a0ff'];
        for(let i=0; i<50; i++) {
            const c = document.createElement('div');
            c.style.position = 'fixed';
            c.style.width = '10px'; c.style.height = '10px';
            c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            c.style.left = '50%'; c.style.top = '50%';
            c.style.zIndex = '9999';
            document.body.appendChild(c);
            
            const angle = Math.random() * Math.PI * 2;
            const velocity = 10 + Math.random() * 20;
            const vx = Math.cos(angle) * velocity;
            const vy = Math.sin(angle) * velocity;
            
            let x = window.innerWidth / 2;
            let y = window.innerHeight / 2;
            let t = 0;
            
            const anim = setInterval(() => {
                x += vx;
                y += vy + (0.5 * t); // Gravity
                c.style.left = x + 'px';
                c.style.top = y + 'px';
                c.style.transform = `rotate(${t * 10}deg)`;
                t++;
                if(y > window.innerHeight) {
                    clearInterval(anim);
                    c.remove();
                }
            }, 20);
        }
    }

  </script>
</body>
</html>
